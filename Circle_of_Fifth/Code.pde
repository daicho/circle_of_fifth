// コード一覧
public Code[] codes = {
  new Code("A", 0, new int[]{0, 4, 7}),
  new Code("B♭", 1, new int[]{1, 5, 8}),
  new Code("B", 2, new int[]{2, 6, 9}),
  new Code("C", 3, new int[]{3, 7, 10}),
  new Code("D♭", 4, new int[]{4, 8, 11}),
  new Code("D", 5, new int[]{5, 9, 0}),
  new Code("E♭", 6, new int[]{6, 10, 1}),
  new Code("E", 7, new int[]{7, 11, 2}),
  new Code("F", 8, new int[]{8, 0, 3}),
  new Code("G♭", 9, new int[]{9, 1, 4}),
  new Code("G", 10, new int[]{10, 2, 5}),
  new Code("A♭", 11, new int[]{11, 3, 6}),
  new Code("Am", 0, new int[]{0, 3, 7}),
  new Code("B♭m", 1, new int[]{1, 4, 8}),
  new Code("Bm", 2, new int[]{2, 5, 9}),
  new Code("Cm", 3, new int[]{3, 6, 10}),
  new Code("C♯m", 4, new int[]{4, 7, 11}),
  new Code("Dm", 5, new int[]{5, 8, 0}),
  new Code("E♭m", 6, new int[]{6, 9, 1}),
  new Code("Em", 7, new int[]{7, 10, 2}),
  new Code("Fm", 8, new int[]{8, 11, 3}),
  new Code("F♯m", 9, new int[]{9, 0, 4}),
  new Code("Gm", 10, new int[]{10, 1, 5}),
  new Code("G♯m", 11, new int[]{11, 2, 6}),
  new Code("Am(♭5)", 0, new int[]{0, 3, 6}),
  new Code("A♯m(♭5)", 1, new int[]{1, 4, 7}),
  new Code("Bm(♭5)", 2, new int[]{2, 5, 8}),
  new Code("Cm(♭5)", 3, new int[]{3, 6, 9}),
  new Code("C♯m(♭5)", 4, new int[]{4, 7, 10}),
  new Code("Dm(♭5)", 5, new int[]{5, 8, 11}),
  new Code("D♯m(♭5)", 6, new int[]{6, 9, 0}),
  new Code("Em(♭5)", 7, new int[]{7, 10, 1}),
  new Code("Fm(♭5)", 8, new int[]{8, 11, 2}),
  new Code("F♯m(♭5)", 9, new int[]{9, 0, 3}),
  new Code("Gm(♭5)", 10, new int[]{10, 1, 4}),
  new Code("G♯m(♭5)", 11, new int[]{11, 2, 5}),
  new Code("A7", 0, new int[]{0, 4, 7, 10}),
  new Code("B♭7", 1, new int[]{1, 5, 8, 11}),
  new Code("B7", 2, new int[]{2, 6, 9, 0}),
  new Code("C7", 3, new int[]{3, 7, 10, 1}),
  new Code("D♭7", 4, new int[]{4, 8, 11, 2}),
  new Code("D7", 5, new int[]{5, 9, 0, 3}),
  new Code("E♭7", 6, new int[]{6, 10, 1, 4}),
  new Code("E7", 7, new int[]{7, 11, 2, 5}),
  new Code("F7", 8, new int[]{8, 0, 3, 6}),
  new Code("G♭7", 9, new int[]{9, 1, 4, 7}),
  new Code("G7", 10, new int[]{10, 2, 5, 8}),
  new Code("A♭7", 11, new int[]{11, 3, 6, 9}),
  new Code("Am7", 0, new int[]{0, 3, 7, 10}),
  new Code("B♭m7", 1, new int[]{1, 4, 8, 11}),
  new Code("Bm7", 2, new int[]{2, 5, 9, 0}),
  new Code("Cm7", 3, new int[]{3, 6, 10, 1}),
  new Code("C♯m7", 4, new int[]{4, 7, 11, 2}),
  new Code("Dm7", 5, new int[]{5, 8, 0, 3}),
  new Code("E♭m7", 6, new int[]{6, 9, 1, 4}),
  new Code("Em7", 7, new int[]{7, 10, 2, 5}),
  new Code("Fm7", 8, new int[]{8, 11, 3, 6}),
  new Code("F♯m7", 9, new int[]{9, 0, 4, 7}),
  new Code("Gm7", 10, new int[]{10, 1, 5, 8}),
  new Code("G♯m7", 11, new int[]{11, 2, 6, 9}),
  new Code("Am7(♭5)", 0, new int[]{0, 3, 6, 10}),
  new Code("A♯m7(♭5)", 1, new int[]{1, 4, 7, 11}),
  new Code("Bm7(♭5)", 2, new int[]{2, 5, 8, 0}),
  new Code("Cm7(♭5)", 3, new int[]{3, 6, 9, 1}),
  new Code("C♯m7(♭5)", 4, new int[]{4, 7, 10, 2}),
  new Code("Dm7(♭5)", 5, new int[]{5, 8, 11, 3}),
  new Code("D♯m7(♭5)", 6, new int[]{6, 9, 0, 4}),
  new Code("Em7(♭5)", 7, new int[]{7, 10, 1, 5}),
  new Code("Fm7(♭5)", 8, new int[]{8, 11, 2, 6}),
  new Code("F♯m7(♭5)", 9, new int[]{9, 0, 3, 7}),
  new Code("Gm7(♭5)", 10, new int[]{10, 1, 4, 8}),
  new Code("G♯m7(♭5)", 11, new int[]{11, 2, 5, 9}),
  new Code("AM7", 0, new int[]{0, 4, 7, 11}),
  new Code("B♭M7", 1, new int[]{1, 5, 8, 0}),
  new Code("BM7", 2, new int[]{2, 6, 9, 1}),
  new Code("CM7", 3, new int[]{3, 7, 10, 2}),
  new Code("D♭M7", 4, new int[]{4, 8, 11, 3}),
  new Code("DM7", 5, new int[]{5, 9, 0, 4}),
  new Code("E♭M7", 6, new int[]{6, 10, 1, 5}),
  new Code("EM7", 7, new int[]{7, 11, 2, 6}),
  new Code("FM7", 8, new int[]{8, 0, 3, 7}),
  new Code("G♭M7", 9, new int[]{9, 1, 4, 8}),
  new Code("GM7", 10, new int[]{10, 2, 5, 9}),
  new Code("A♭M7", 11, new int[]{11, 3, 6, 10}),
  new Code("AmM7", 0, new int[]{0, 3, 7, 11}),
  new Code("B♭mM7", 1, new int[]{1, 4, 8, 0}),
  new Code("BmM7", 2, new int[]{2, 5, 9, 1}),
  new Code("CmM7", 3, new int[]{3, 6, 10, 2}),
  new Code("C♯mM7", 4, new int[]{4, 7, 11, 3}),
  new Code("DmM7", 5, new int[]{5, 8, 0, 4}),
  new Code("E♭mM7", 6, new int[]{6, 9, 1, 5}),
  new Code("EmM7", 7, new int[]{7, 10, 2, 6}),
  new Code("FmM7", 8, new int[]{8, 11, 3, 7}),
  new Code("F♯mM7", 9, new int[]{9, 0, 4, 8}),
  new Code("GmM7", 10, new int[]{10, 1, 5, 9}),
  new Code("G♯mM7", 11, new int[]{11, 2, 6, 10}),
  new Code("Adim", 0, new int[]{0, 3, 6, 9}),
  new Code("A♯dim", 1, new int[]{1, 4, 7, 10}),
  new Code("Bdim", 2, new int[]{2, 5, 8, 11}),
  new Code("Cdim", 3, new int[]{3, 6, 9, 0}),
  new Code("C♯dim", 4, new int[]{4, 7, 10, 1}),
  new Code("Ddim", 5, new int[]{5, 8, 11, 2}),
  new Code("D♯dim", 6, new int[]{6, 9, 0, 3}),
  new Code("Edim", 7, new int[]{7, 10, 1, 4}),
  new Code("Fdim", 8, new int[]{8, 11, 2, 5}),
  new Code("F♯dim", 9, new int[]{9, 0, 3, 6}),
  new Code("Gdim", 10, new int[]{10, 1, 4, 7}),
  new Code("G♯dim", 11, new int[]{11, 2, 5, 8})
};

// コード
public class Code {
  public String name;
  private int base;
  private int[] notes;

  public Code(String name, int base, int[] notes) {
    this.name = name;
    this.base = base;
    this.notes = notes;
  }

  // 転回形
  private int[] inversion(int n) {
    int[] inverted_notes = new int[notes.length];
    int prev = base;

    for (int i = 0; i < notes.length; i++) {
      int p = (n + i) % notes.length;
      inverted_notes[i] = floor(float(prev - notes[p] + OCTAVE_NUM) / OCTAVE_NUM) * OCTAVE_NUM + notes[p];
      prev = inverted_notes[i];
    }

    return inverted_notes;
  }

  // ボイジング
  int[] voicing(int center) {
    float min_diff = OCTAVE_NUM;
    float min_ave = 0;
    int min_i = 0;

    for (int i = 0; i < notes.length; i++) {
      int[] inverted_notes = inversion(i);
      float sum = 0, ave, diff;

      // 転回コードの重心を算出
      for (int j = 0; j < inverted_notes.length; j++)
        sum += inverted_notes[j];
      ave = sum / inverted_notes.length;

      // 中心音からの距離を算出
      diff = (ave - center) % OCTAVE_NUM;
      if (abs(diff) > OCTAVE_NUM / 2.0)
        diff = (diff < 0) ? (diff + OCTAVE_NUM) : (diff - OCTAVE_NUM);

      // 一番中心音に近いものを残す
      if (abs(diff) < abs(min_diff)) {
        min_diff = diff;
        min_ave = ave;
        min_i = i;
      }
    }

    // コードを再構成
    int offset = round(center + min_diff - min_ave);
    int[] voiced_notes = concat(new int[]{base}, inversion(min_i));

    for (int i = 0; i < voiced_notes.length; i++)
      voiced_notes[i] = voiced_notes[i] + offset;

    return voiced_notes;
  }
}
